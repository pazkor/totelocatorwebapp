function getLastColumn(aisle, site) {
    if (site === "注拽") {
        const lastColumnMap = {1: 91, 2: 91, 7: 71};
        return lastColumnMap[aisle] || 74;
    } else if (site === "") {
        return 64;
    } else if (site === "专 砖注") {
        const lastColumnMap = {1: 99, 2: 99};
        return lastColumnMap[aisle] || 98;
    }
    return null;
}

function parseLocation(locationStr, site) {
    try {
        const parts = locationStr.split(":");
        const aisle = parseInt(parts[0]);
        const details = parts[1].replace("(", "").replace(")", "").split(",");
        const side = parseInt(details[0]);
        const column = parseInt(details[1]);
        const floor = parseInt(details[2]);
        const cell = parseInt(parts[2]);

        const sideDescFront = side === -1 ? "砖" : "";
        const sideDescBack = side === -1 ? "" : "砖"; // Opposite side when entering from the back
        const lastColumn = getLastColumn(aisle, site);

        if (lastColumn === null) {
            return " 砖: 转专  专!";
        }

        const columnsFromBack = lastColumn - column;

        return `
         注专: ${aisle}<br>
         爪: ${sideDescFront} (砖专 住转 拽转 注专)<br>
         注: ${column}<br>
         拽: ${floor}<br>
         转: ${cell}<br>
         住驻专 注转 住驻专 住 拽 专: ${columnsFromBack}<br><br>

          爪 注专 ${aisle}, 爪 ${sideDescFront} (拽转 注专), 注 ${column}, 拽 ${floor}, 转 住驻专 ${cell}.<br>
          转 住 拽 专, 注 住驻专 ${columnsFromBack} 注转 拽,   爪 ${sideDescBack}.<br><br>

         转专转: 转专, 住驻专 -0.
        `;
    } catch (error) {
        return " 砖:  砖转 转 拽 驻专 !";
    }
}

document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("calculate").addEventListener("click", function () {
        const locationStr = document.getElementById("location").value;
        const site = document.getElementById("site").value;

        const result = parseLocation(locationStr, site);
        document.getElementById("result").innerHTML = result;
    });
});
