function getLastColumn(aisle, site) {
    if (site === "עמק") {
        const lastColumnMap = {1: 91, 2: 91, 7: 71};
        return lastColumnMap[aisle] || 74;
    } else if (site === "חולון") {
        return 64;
    } else if (site === "באר שבע") {
        const lastColumnMap = {1: 99, 2: 99};
        return lastColumnMap[aisle] || 98;
    }
    return null;
}

function parseLocation(locationStr, site) {
    try {
        const parts = locationStr.split(":");
        const aisle = parseInt(parts[0]);
        const details = parts[1].replace("(", "").replace(")", "").split(",");
        const side = parseInt(details[0]);
        const column = parseInt(details[1]);
        const floor = parseInt(details[2]);
        const cell = parseInt(parts[2]);

        const sideDescFront = side === -1 ? "שמאל" : "ימין";
        const sideDescBack = side === -1 ? "ימין" : "שמאל"; // Opposite side when entering from the back
        const lastColumn = getLastColumn(aisle, site);

        if (lastColumn === null) {
            return "🔴 שגיאה: האתר לא מוכר!";
        }

        const columnsFromBack = lastColumn - column;

        return `
        🔴 מעבר: ${aisle}<br>
        🔴 צד: ${sideDescFront} (כאשר מסתכלים מקדמת המעבר)<br>
        🔴 עמודה: ${column}<br>
        🔴 קומה: ${floor}<br>
        🔴 תא: ${cell}<br>
        🔴 מספר עמודות לספור בכניסה מהחלק האחורי: ${columnsFromBack}<br><br>

        🔴 הטוט נמצא במעבר ${aisle}, בצד ${sideDescFront} (מקדמת המעבר), בעמודה ${column}, בקומה ${floor}, בתא מספר ${cell}.<br>
        🔴 אם אתה נכנס מהחלק האחורי, עליך לספור ${columnsFromBack} עמודות קדימה, והטוט יהיה בצד ${sideDescBack}.<br><br>

        🔴 תזכורת: באתר, סופרים מ-0.
        `;
    } catch (error) {
        return "🔴 שגיאה: ודא שהזנת את המיקום בפורמט הנכון!";
    }
}

document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("calculate").addEventListener("click", function () {
        const locationStr = document.getElementById("location").value;
        const site = document.getElementById("site").value;

        const result = parseLocation(locationStr, site);
        document.getElementById("result").innerHTML = result;
    });
});
