function getLastColumn(aisle, site) {
    if (site === "注拽") {
        const lastColumnMap = {1: 91, 2: 91, 7: 71};
        return lastColumnMap[aisle] || 74;
    } else if (site === "") {
        return 64;
    } else if (site === "专 砖注") {
        const lastColumnMap = {1: 99, 2: 99};
        return lastColumnMap[aisle] || 98;
    }
    return null;
}

function parseLocation(locationStr, site) {
    try {
        const parts = locationStr.split(":");
        const aisle = parseInt(parts[0]);
        const details = parts[1].replace("(", "").replace(")", "").split(",");
        const side = parseInt(details[0]);
        const column = parseInt(details[1]);
        const floor = parseInt(details[2]);
        const cell = parseInt(parts[2]);

        const sideDescFront = side === -1 ? "砖" : "";
        const sideDescBack = side === -1 ? "" : "砖"; // 驻 爪 砖专 住 拽 专
        const lastColumn = getLastColumn(aisle, site);

        if (lastColumn === null) {
            return `<span style="color:red;"> 砖: 转专  专!</span>`;
        }

        const columnsFromBack = lastColumn - column;

        return `
        <strong> 注专:</strong> ${aisle}<br>
        <strong> 爪:</strong> ${sideDescFront} (砖专 住转 拽转 注专)<br>
        <strong> 注:</strong> ${column}<br>
        <strong> 拽:</strong> ${floor}<br>
        <strong> 转:</strong> ${cell}<br>
        <strong> 住驻专 注转 住驻专 住 拽 专:</strong> ${columnsFromBack}<br><br>

        <strong>  爪 注专 ${aisle}, 爪 ${sideDescFront} (拽转 注专), 注 ${column}, 拽 ${floor}, 转 住驻专 ${cell}.</strong><br>
        <strong>  转 住 拽 专, 注 住驻专 ${columnsFromBack} 注转 拽,   爪 ${sideDescBack}.</strong><br><br>

        <span style="color:red;"> 转专转: 转专, 住驻专 -0.</span>
        `;
    } catch (error) {
        return `<span style="color:red;"> 砖:  砖转 转 拽 驻专 !</span>`;
    }
}

document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("calculate").addEventListener("click", function () {
        const locationStr = document.getElementById("location").value;
        const site = document.getElementById("site").value;

        const result = parseLocation(locationStr, site);
        document.getElementById("result").innerHTML = result; // 砖砖 -innerHTML 拽 innerText
    });
});
